<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Workout Builder</title>
<meta name="theme-color" content="#ffffff" />
<style>
  :root{
    /* Neutral, minimal theme */
    --bg: #f6f7fb;
    --surface: #ffffff;
    --surface-2:#ffffff;
    --text: #111827;
    --muted:#6b7280;
    --primary:#2563eb; /* blue-600 */
    --border:#e5e7eb;

    --radius:14px;
    --gap:14px;
    --shadow: 0 8px 20px rgba(0,0,0,.06);
  }

  html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"; }
  .app { min-height: 100vh; display: flex; flex-direction: column; }

  header{ padding: 18px 16px; background: var(--surface); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 10; }
  .header-inner{ max-width: 1100px; margin: 0 auto; display:flex; align-items:center; gap: 16px; justify-content: space-between; }
  .brand{ display:flex; align-items:center; gap:10px; }
  .brand .logo{ width:34px; height:34px; border-radius:8px; background: #e5edff; border:1px solid #dbe6ff; }
  .brand h1{ margin:0; font-size: 18px; font-weight: 700; }

  main{ flex: 1; padding: 20px 16px 32px; }
  .container{ max-width: 1100px; margin: 0 auto; display: grid; gap: var(--gap); grid-template-columns: 1.1fr .9fr; }
  @media (max-width: 980px){ .container{ grid-template-columns: 1fr; } }

  .card{ background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
  .card .card-h{ padding: 14px 16px; border-bottom: 1px solid var(--border); display:flex; align-items:center; justify-content:space-between; gap:10px; }
  .card .card-b{ padding: 14px 16px; }

  .form-row{ display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
  @media (max-width: 620px){ .form-row{ grid-template-columns: 1fr; } }
  label{ display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
  input[type="text"], select, textarea{
    width: 100%; box-sizing: border-box; padding: 10px 12px; border-radius: 12px;
    border: 1px solid var(--border); background: #fff; color: var(--text); outline: none;
    transition: box-shadow .12s ease, border-color .12s ease;
  }
  input[type="text"]:focus, select:focus, textarea:focus{
    border-color: #bfdbfe; box-shadow: 0 0 0 4px rgba(37,99,235,.15);
  }

  .btn{ appearance:none; border:1px solid var(--border); cursor:pointer;
    padding: 9px 13px; border-radius: 10px; color: #fff; font-weight: 600;
    background: var(--primary); transition: transform .06s ease, filter .15s ease; }
  .btn:hover{ filter: brightness(1.04); }
  .btn:active{ transform: translateY(1px); }
  .btn.ghost{ background: #fff; color: var(--text); }
  .btn.warn{ background: #ef4444; border-color: #ef4444; }
  .btn.ok{ background: #10b981; border-color: #10b981; }
  .inline{ display:flex; gap:10px; flex-wrap: wrap; align-items:center; }

  .day{ border: 1px dashed var(--border); border-radius: 12px; padding: 12px; margin-bottom: var(--gap); background: #fff; }
  .day-h{ display:flex; align-items:center; gap:10px; justify-content:space-between; }
  .day-title{ font-weight:700; letter-spacing:.2px; }
  .exercise-list{ margin: 10px 0 0; padding: 0; list-style: none; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  @media (max-width: 720px){ .exercise-list{ grid-template-columns: 1fr; } }
  .chip{ background: #f8fafc; border:1px solid var(--border); border-radius: 999px; padding: 7px 10px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
  .chip .x{ background: transparent; border:0; color: var(--muted); cursor:pointer; font-weight:700; }

  .muted{ color:var(--muted); } .small{ font-size: 12px; } .spacer{ height: 8px; }
  body.compact .exercise-list{ grid-template-columns: 1fr; }

  footer{ padding: 14px; text-align:center; color: var(--muted); }

  .toast{ position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background:#111827; color:#fff;
    border-radius:10px; padding:8px 12px; font-size:12px; z-index:999; }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Workout Builder</h1>
      </div>
      <div class="head-actions">
        <button id="btnExport" class="btn ghost" title="Download your plan as JSON">Export JSON</button>
        <button id="btnImport" class="btn ghost">Import JSON</button>
        <input id="importFile" type="file" accept="application/json" hidden />
        <button id="btnClear" class="btn warn">Clear</button>
        <button id="btnSave" class="btn ok">Save Workout</button>
        <button id="btnForce" class="btn ghost" title="Clear old saves & unregister SW">Force Refresh</button>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="card" id="builder">
        <div class="card-h">
          <strong>Workout Builder</strong>
          <div class="inline"><button class="btn ghost" id="addDayBtn">+ Add Day</button></div>
        </div>
        <div class="card-b">
          <div class="form-row" style="margin-bottom: 14px;">
            <div>
              <label for="workoutName">Workout Name</label>
              <input id="workoutName" type="text" placeholder="e.g., Push / Pull / Legs" />
            </div>
            <div>
              <label for="presetSelect">Preset</label>
              <select id="presetSelect"><option value="">— Choose a preset —</option></select>
            </div>
          </div>
          <div id="days" aria-live="polite"></div>
        </div>
      </section>

      <aside class="card">
        <div class="card-h">
          <strong>Quick Add</strong>
          <div class="inline small muted">Fast tools</div>
        </div>
        <div class="card-b">
          <div class="form-row">
            <div>
              <label for="newDayName">New Day Name</label>
              <input id="newDayName" type="text" placeholder="e.g., Chest, Legs, Back/Shoulders" />
            </div>
            <div class="inline" style="align-items:flex-end;">
              <button id="quickAddDay" class="btn">Add Day</button>
              <button id="collapseAll" class="btn ghost" title="Toggle compact view">Collapse All</button>
            </div>
          </div>

          <div class="spacer"></div>
          <div class="form-row">
            <div>
              <label for="bulkExercises">Bulk Add Exercises (one per line to selected day)</label>
              <textarea id="bulkExercises" rows="5" placeholder="Highlight a day, then paste list here…&#10;Bench Press&#10;Lat Pulldown&#10;Lateral Raise"></textarea>
            </div>
            <div class="inline" style="align-items:flex-end;">
              <button id="bulkAddBtn" class="btn">Add to Selected Day</button>
            </div>
          </div>

          <p class="small muted" style="margin-top:12px;">Tip: Click a day card to select it, then use Bulk Add to drop in a list quickly.</p>
        </div>
      </aside>
    </div>
  </main>

  <footer>Built with ❤️ for smooth gains. Positions & layout unchanged — just neutral styling.</footer>
</div>

<script>
/* ========= Versioned storage ========= */
const APP_VERSION = '2025-08-14-neutral';
const STORAGE_KEY = `fitforge_workout_${APP_VERSION}`;

/* ========= Presets ========= */
function tSnowy() {
  return {
    name: "Snowy's Log",
    days: [
      { name: 'Chest', ex: [
        'Barbell Bench Press','Machine Chest Press','Machine Shoulder Press',
        'Incline Dumbbell Press','Machine Chest Fly','Overhead Rope Triceps Extension'
      ]},
      { name: 'Legs', ex: [
        'Seated Leg Curl','Leg Press','Leg Press Calf Raise','Leg Extensions',
        'Hip Thrusts','Hip Adductors','Hip Abductors'
      ]},
      { name: 'Back/Shoulders', ex: [
        'Upright Row','Machine Row','Close Grip Lat Pulldown','Seated Cable Row',
        'Reverse Machine Fly','Cable Lateral Raise','Dumbbell Shrugs','Hammer Curls'
      ]},
      { name: 'Core', ex: ['Decline Ab Crunch','Machine Crunch','Wood Chopper','Dumbbell Side Bend'] }
    ]
  };
}
function tUpperLower(){
  return { name:'Upper / Lower', days:[
    { name: 'Upper', ex: ['Bench Press','Row','Overhead Press','Lat Pulldown','Face Pull','Triceps Pushdown','DB Curl'] },
    { name: 'Lower', ex: ['Back Squat','RDL','Leg Press','Leg Curl','Calf Raise','Hanging Knee Raise'] }
  ]};
}
function tPPL(){
  return { name:'Push Pull Legs', days:[
    { name: 'Push', ex: ['Bench Press','Incline DB Press','OHP','Lateral Raise','Rope Pressdown'] },
    { name: 'Pull', ex: ['Deadlift','Barbell Row','Lat Pulldown','Rear Delt Fly','Hammer Curl'] },
    { name: 'Legs', ex: ['Back Squat','Leg Press','Leg Curl','Calf Raise','Ab Wheel'] }
  ]};
}
const PRESETS = [ tSnowy(), tUpperLower(), tPPL() ];

/* ========= State ========= */
let state = { name: '', days: [] };
let selectedDayIndex = -1;

/* ========= DOM ========= */
const workoutNameEl = document.getElementById('workoutName');
const daysEl = document.getElementById('days');
const presetSelect = document.getElementById('presetSelect');
const addDayBtn = document.getElementById('addDayBtn');
const quickAddDayBtn = document.getElementById('quickAddDay');
const newDayNameEl = document.getElementById('newDayName');
const bulkExercisesEl = document.getElementById('bulkExercises');
const bulkAddBtn = document.getElementById('bulkAddBtn');
const btnSave = document.getElementById('btnSave');
const btnClear = document.getElementById('btnClear');
const btnExport = document.getElementById('btnExport');
const btnImport = document.getElementById('btnImport');
const importFile = document.getElementById('importFile');
const collapseAllBtn = document.getElementById('collapseAll');
const btnForce = document.getElementById('btnForce');

/* ========= Init ========= */
function init(){
  PRESETS.forEach((p, i) => {
    const opt = document.createElement('option');
    opt.value = String(i);
    opt.textContent = p.name;
    presetSelect.appendChild(opt);
  });

  presetSelect.addEventListener('change', onPresetChoose);
  workoutNameEl.addEventListener('input', e => { state.name = e.target.value; persist(); });

  addDayBtn.addEventListener('click', () => addDay((newDayNameEl.value || 'New Day').trim()));
  quickAddDayBtn.addEventListener('click', () => addDay((newDayNameEl.value || 'New Day').trim()));
  bulkAddBtn.addEventListener('click', onBulkAdd);

  btnSave.addEventListener('click', onSave);
  btnClear.addEventListener('click', clearAll);
  btnExport.addEventListener('click', onExport);
  btnImport.addEventListener('click', () => importFile.click());
  importFile.addEventListener('change', onImportFile);
  collapseAllBtn.addEventListener('click', () => document.body.classList.toggle('compact'));
  btnForce.addEventListener('click', forceRefresh);

  const cached = localStorage.getItem(STORAGE_KEY);
  if (cached) { try { const parsed = JSON.parse(cached); if (parsed?.days?.length>=0) state = parsed; } catch {} }
  render();
}

/* ========= Preset handling ========= */
function onPresetChoose(){
  const idx = Number(presetSelect.value);
  if (Number.isNaN(idx)) return;
  const preset = PRESETS[idx]; if (!preset) return;

  state = structuredClone(preset);
  state.days = state.days.map(d => ({ name: d.name, ex: [...d.ex] }));
  selectedDayIndex = -1;
  render();
  toast(`${preset.name} loaded`);
}

/* ========= Render ========= */
function render(){
  workoutNameEl.value = state.name || '';
  daysEl.innerHTML = '';
  state.days.forEach((day, i) => {
    const dayEl = document.createElement('div');
    dayEl.className = 'day';
    if (i === selectedDayIndex) dayEl.style.boxShadow = '0 0 0 2px rgba(37,99,235,.35) inset';

    const h = document.createElement('div'); h.className = 'day-h';
    const left = document.createElement('div'); left.className = 'inline';
    const title = document.createElement('div'); title.className = 'day-title'; title.textContent = day.name;
    left.appendChild(title);

    const right = document.createElement('div'); right.className = 'inline';
    right.append(btn('ghost','Rename',()=>renameDay(i)), btn('', '+ Exercise',()=>addExercise(i)), btn('warn','Delete',()=>deleteDay(i)));
    h.append(left, right);

    const ul = document.createElement('ul'); ul.className = 'exercise-list';
    day.ex.forEach((ex, j) => {
      const li = document.createElement('li');
      const chip = document.createElement('div'); chip.className = 'chip';
      chip.innerHTML = `<span>${ex}</span>`;
      const actions = document.createElement('div'); actions.className = 'inline';
      const edit = document.createElement('button'); edit.className = 'x'; edit.textContent = '✎'; edit.title = 'Edit name';
      edit.addEventListener('click', (ev)=>{ ev.stopPropagation(); const n = prompt('Edit exercise:', ex); if (n && n.trim()){ state.days[i].ex[j]=n.trim(); persist(); render(); }});
      const x = document.createElement('button'); x.className = 'x'; x.textContent = '✕'; x.title = 'Remove';
      x.addEventListener('click', (ev)=>{ ev.stopPropagation(); state.days[i].ex.splice(j,1); persist(); render(); });
      actions.append(edit,x); chip.appendChild(actions); li.appendChild(chip); ul.appendChild(li);
    });

    dayEl.append(h, ul);
    dayEl.addEventListener('click', ()=>{ selectedDayIndex = i===selectedDayIndex ? -1 : i; render(); });
    daysEl.appendChild(dayEl);
  });
  persist();
}
function btn(style, text, onClick){ const b=document.createElement('button'); b.className='btn '+(style||''); b.textContent=text; b.addEventListener('click',(e)=>{e.stopPropagation(); onClick();}); return b; }

/* ========= Mutations ========= */
function addDay(name){ if(!name) return; state.days.push({ name, ex: [] }); selectedDayIndex = state.days.length-1; newDayNameEl.value=''; render(); }
function renameDay(i){ const n=prompt('Rename day', state.days[i].name); if(n&&n.trim()){ state.days[i].name=n.trim(); render(); } }
function deleteDay(i){ if(!confirm(`Delete day "${state.days[i].name}"?`)) return; state.days.splice(i,1); if(selectedDayIndex===i) selectedDayIndex=-1; render(); }
function addExercise(dayIndex){ const n=prompt('Exercise name'); if(n&&n.trim()){ state.days[dayIndex].ex.push(n.trim()); render(); } }
function onBulkAdd(){
  if (selectedDayIndex < 0){ alert('Select a day (click its card) first.'); return; }
  const txt = bulkExercisesEl.value; if(!txt.trim()) return;
  const items = txt.split(/[\n,]+/).map(s=>s.trim()).filter(Boolean);
  state.days[selectedDayIndex].ex.push(...items); bulkExercisesEl.value=''; render();
}

/* ========= IO ========= */
function onSave(){
  if (!state.name || !state.name.trim()){ alert('Give your workout a name before saving.'); return; }
  persist(); toast('Workout saved');
}
function clearAll(){ if(!confirm('Clear the current builder?')) return; state={name:'',days:[]}; selectedDayIndex=-1; presetSelect.value=''; render(); }
function onExport(){
  const a = document.createElement('a');
  a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state, null, 2));
  a.download = (state.name || 'workout') + ".json"; document.body.appendChild(a); a.click(); a.remove();
}
function onImportFile(e){
  const file = e.target.files[0]; if(!file) return;
  const r = new FileReader();
  r.onload = ()=>{ try{ const loaded=JSON.parse(r.result);
    if(!loaded || !Array.isArray(loaded.days)) throw new Error('Invalid file');
    state=loaded; selectedDayIndex=-1; render(); toast('Workout imported');
  }catch(err){ alert('Import failed: '+err.message);} finally{ importFile.value=''; } };
  r.readAsText(file);
}
function persist(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch{} }

/* ========= UI helpers ========= */
function toast(msg){ const old=document.querySelector('.toast'); if(old) old.remove(); const t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),1300); }
function forceRefresh(){
  try{ Object.keys(localStorage).forEach(k=>{ if(k.startsWith('fitforge_workout')) localStorage.removeItem(k); }); }catch{}
  if('serviceWorker' in navigator){ navigator.serviceWorker.getRegistrations?.().then(regs=>{ regs.forEach(r=>r.unregister()); location.reload(true); }); }
  else { location.reload(true); }
}

window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
